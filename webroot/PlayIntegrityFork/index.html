<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PlayIntegrityFork Controls</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
:root {
  --accent-light: #ec407a;
  --accent-dark: #f5d491;
  --bg-light: #fff0f4;
  --bg-dark: #1c1c1e;
  --card-light: #fff;
  --card-dark: #2c2c2e;
  --text-light: #111;
  --text-dark: #f5f5f7;
  --shadow-light: rgba(0,0,0,0.12);
  --shadow-dark: rgba(0,0,0,0.55);
  --transition: 0.3s ease;
}

body {
  margin:0; padding:0;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  min-height:100vh;
  font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: var(--bg-dark);
  color: var(--text-dark);
  transition: background var(--transition), color var(--transition);
}

body.light {
  background: var(--bg-light);
  color: var(--text-light);
}

.card {
  width: 260px; max-width:90vw;
  background: var(--card-dark);
  border-radius: 28px;
  padding: 24px;
  box-shadow:0 12px 28px var(--shadow-dark);
  transition: background var(--transition), box-shadow var(--transition);
}

body.light .card {
  background: var(--card-light);
  box-shadow:0 12px 28px var(--shadow-light);
}

h1 {text-align:center; font-size:20px; font-weight:700; margin-bottom:18px; transition:color var(--transition);}
body.light h1 {color:var(--accent-light);}
h1 .material-icons {vertical-align:middle; font-size:22px;}

.row {
  display:flex; justify-content:space-between; align-items:center;
  padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.08); font-weight:700;
  transition:border-color var(--transition);
}
body.light .row {border-bottom:1px solid rgba(0,0,0,0.08);}
.row label {display:flex; align-items:center; gap:8px;}

.switch {position:relative; width:52px; height:32px;}
.switch input {opacity:0; width:0; height:0;}
.slider {position:absolute; inset:0; border-radius:34px; background:#3a3a3c; transition:background var(--transition);}
body.light .slider {background:#fff0f4;}
.knob {position:absolute; left:3px; bottom:3px; width:26px; height:26px; background:#fff; border-radius:50%; transition:transform var(--transition);}
input:checked + .slider {background:var(--accent-dark);}
body.light input:checked + .slider {background:var(--accent-light);}
input:checked + .slider .knob {transform:translateX(20px);}

button {
  margin-top:16px; width:100%;
  padding:12px; border:none; border-radius:16px;
  font-weight:700; cursor:pointer; transition:background var(--transition), transform 0.2s;
  display:flex; align-items:center; justify-content:center; gap:6px;
  background:var(--accent-dark); color:#111;
}
body.light button {background:var(--accent-light); color:#fff;}
button:hover {transform:scale(1.02); opacity:0.9;}

.theme-toggle {display:flex; justify-content:center; margin-bottom:18px;}

footer {margin-top:24px; font-size:12px; color:#888; text-align:center;}
</style>
</head>
<body>

<div class="theme-toggle">
  <label class="switch">
    <input type="checkbox" id="themeToggle">
    <span class="slider"><span class="knob"></span></span>
  </label>
</div>

<div class="card">
  <h1><span class="material-icons">android</span> Play Integrity Fork Controls</h1>

  <div class="row"><label><span class="material-icons">build</span> Spoof Build</label><label class="switch"><input type="checkbox" id="spoofBuild"><span class="slider"><span class="knob"></span></span></label></div>
  <div class="row"><label><span class="material-icons">public</span> Spoof Props</label><label class="switch"><input type="checkbox" id="spoofProps"><span class="slider"><span class="knob"></span></span></label></div>
  <div class="row"><label><span class="material-icons">send_time_extension</span> Spoof Provider</label><label class="switch"><input type="checkbox" id="spoofProvider"><span class="slider"><span class="knob"></span></span></label></div>
  <div class="row"><label><span class="material-icons">api</span> Spoof Signature</label><label class="switch"><input type="checkbox" id="spoofSignature"><span class="slider"><span class="knob"></span></span></label></div>
  <div class="row"><label><span class="material-icons">verified_user</span> Spoof Vending Finger</label><label class="switch"><input type="checkbox" id="spoofVendingFinger"><span class="slider"><span class="knob"></span></span></label></div>
  <div class="row"><label><span class="material-icons">shop</span> Spoof Vending SDK</label><label class="switch"><input type="checkbox" id="spoofVendingSdk"><span class="slider"><span class="knob"></span></span></label></div>
  <div class="row"><label><span class="material-icons">bug_report</span> Verbose Logs</label><label class="switch"><input type="checkbox" id="verboseLogs"><span class="slider"><span class="knob"></span></span></label></div>

  <button id="restartBtn"><span class="material-icons">restart_alt</span> Restart GMS</button>
</div>

<footer>IntegrityBox &copy; 2025 - Use responsibly</footer>

<script>
const modulePaths = [
  "/data/adb/modules/playintegrityfix/custom.pif.json",
  "/data/adb/modules/playintegrityfix/custom.pif.prop",
  "/data/adb/modules/playintegrityfix/pif.prop"
];
const props = ["spoofBuild","spoofProps","spoofProvider","spoofSignature","spoofVendingFinger","spoofVendingSdk","verboseLogs"];

async function runShell(cmd){try{await ksu.exec(cmd);}catch(e){}}
async function findConfigFile(){for(const path of modulePaths){const exists=await ksu.exec(`[ -f "${path}" ] && echo found || echo missing`); if(exists.trim()==="found") return path;} return null;}
async function getCurrentValues(file){const content=await ksu.exec(`cat "${file}"`); const map={}; props.forEach(p=>{const match=content.match(new RegExp(`${p}=(\\d+)`)); if(match) map[p]=match[1];}); return map;}
async function updateValue(file,key,value){await runShell(`su -c 'if grep -q "^${key}=" "${file}"; then sed -i "s/^${key}=.*/${key}=${value}/" "${file}"; else echo "${key}=${value}" >> "${file}"; fi'`);}
async function killProcesses(){await runShell("su -c 'am force-stop com.google.android.gms.unstable; am force-stop com.android.vending'");}
async function applyToggle(key,value){const file=await findConfigFile(); if(!file)return alert("⚠️ Config file not found!"); await updateValue(file,key,value); await killProcesses(); localStorage.setItem(`toggle_${key}`,value);}
async function initToggles(){const file=await findConfigFile(); if(!file)return; const values=await getCurrentValues(file); props.forEach(key=>{const toggle=document.getElementById(key); if(!toggle)return; const saved=localStorage.getItem(`toggle_${key}`); const currentValue=saved??values[key]??"0"; toggle.checked=currentValue==="1"||currentValue==="100"; toggle.addEventListener("change",()=>{const newValue=toggle.checked?(key==="verboseLogs"?100:1):0; applyToggle(key,newValue);});});}

document.getElementById("restartBtn").addEventListener("click",async()=>{await killProcesses(); alert("✅ GMS & Play Store restarted!");});

const themeToggle=document.getElementById("themeToggle");
themeToggle.addEventListener("change",()=>{document.body.classList.toggle("light",themeToggle.checked); localStorage.setItem("themeMode",themeToggle.checked?"light":"dark");});

document.addEventListener("DOMContentLoaded",()=>{const theme=localStorage.getItem("themeMode"); if(theme==="light"){document.body.classList.add("light"); themeToggle.checked=true;} initToggles();});
</script>
</body>
</html>